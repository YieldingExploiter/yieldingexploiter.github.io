const fs = require('fs')
const path = require('path')
const {exec} = require('child_process')
const loop = (v)=>{
  v=path.resolve(v)
  fs.readdirSync(v).forEach(x=>{
    x=path.join(v,x)
    if (fs.statSync(x).isDirectory()) loop(x)
    else {
      const dt = fs.readFileSync(x).toString('base64');
      let l = x.reverse();
      l[l.length-1]='modified'
      l=l.join('.');
      const v=(args,outd)=>exec(`magick convert ${x} ${args} ${l}.${outd}`,(err,stdo,stde)=>console.log(`err:${err}\n`,stdo,'\n',stde))
        
      const rescale = (s)=>{
        v(`-resize ${s*100}%`,`.rescale-${s*100}.png`)
        v(`-resize ${s*100}%`,`.rescale-${s*100}.jpg`)
        v(`-resize ${s*100}%`,`.rescale-${s*100}.webp`)
      }
      rescale(3/4)
      rescale(2/3)
      rescale(1/2)
      rescale(1/3)
      rescale(1/4)
      rescale(1/5)
      rescale(1/6)
    }
  })
}
loop('./')
